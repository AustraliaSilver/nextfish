name: Nextfish Auto-Tune
on: [push]

jobs:
  tune:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y g++ make
        # Download cutechess-cli
        wget https://github.com/cutechess/cutechess/releases/download/1.3.1/cutechess-cli-1.3.1-linux64.tar.gz
        tar -xvf cutechess-cli-1.3.1-linux64.tar.gz
        chmod +x cutechess-cli

    - name: Build Nextfish
      run: |
        cd src
        # Set werror=no to prevent warnings from stopping the build
        make -j2 build ARCH=x86-64-modern COMP=gcc werror=no
        mv stockfish ../nextfish

    - name: Run Tournament
      run: |
        # Chạy 50 ván nhanh để kiểm tra sức mạnh ngay sau khi push
        ./cutechess-cli -engine name=Nextfish_New cmd=./nextfish \
                        -engine name=Stockfish_Base cmd=./nextfish option.EvalFile=none \
                        -each proto=uci tc=2+0.05 \
                        -games 2 -rounds 25 \
                        -repeat -concurrency 2 \
                        -pgnout results.pgn
      
    - name: Upload Tournament Results
      uses: actions/upload-artifact@v3
      with:
        name: results-pgn
        path: results.pgn