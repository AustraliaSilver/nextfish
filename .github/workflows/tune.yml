name: Nextfish Auto-Tune
on: [push]

jobs:
  tune:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y g++ make
        # Download fastchess v0.12.0 from Disservin/fastchess
        wget https://github.com/Disservin/fastchess/releases/download/v0.12.0/fastchess-linux-x86-64.tar.gz
        tar -xvf fastchess-linux-x86-64.tar.gz
        chmod +x fastchess

    - name: Build Nextfish
      run: |
        cd src
        make -j2 build ARCH=x86-64-modern COMP=gcc werror=no
        mv stockfish ../nextfish

    - name: Run Tournament
      run: |
        # Chạy 50 ván bằng fastchess
        ./fastchess -engine name=Nextfish_New cmd=./nextfish \
                    -engine name=Stockfish_Base cmd=./nextfish option.EvalFile=none \
                    -each proto=uci tc=2+0.05 \
                    -rounds 25 -games 2 \
                    -repeat -concurrency 2 \
                    -pgnout results.pgn
      
    - name: Upload Tournament Results
      uses: actions/upload-artifact@v4
      with:
        name: results-pgn
        path: results.pgn